from model import load_model, predict, explain_prediction
from config import MODEL_SAVE_PATH, VALUE_CATEGORIES

# Примеры текстов для тестирования с комментариями о ценности
test_texts = [
    # Основная ценность: Жизнь
    ("Здоровье человека и его физическая неприкосновенность - фундаментальные основы общества", "Жизнь"),
    
    # Основная ценность: Патриотизм
    ("Любовь к Родине проявляется в готовности защищать её интересы в любой ситуации", "Патриотизм"),
    
    # Основная ценность: Крепкая семья
    ("Семейные традиции и взаимная поддержка делают нас сильнее перед лицом трудностей", "Крепкая семья"),
    
    # Основные ценности: Созидательный труд + Приоритет духовного
    ("Творческий труд не только создаёт материальные блага, но и развивает духовный мир человека", "Созидательный труд, Приоритет духовного"),
    
    # Основная ценность: Справедливость
    ("Равные права для всех граждан независимо от происхождения - основа справедливого общества", "Справедливость"),
    
    # Основные ценности: Патриотизм + Коллективизм
    ("Защита национальных интересов требует от нас трудолюбия и сплочённости перед внешними вызовами", "Патриотизм, Коллективизм"),
    
    # Основные ценности: Милосердие + Историческая память
    ("Милосердное отношение к слабым и уважение к старшим поколениям сохраняют нашу человечность", "Милосердие, Историческая память"),
    
    # Основные ценности: Приоритет духовного + Крепкая семья
    ("Духовное развитие личности важнее материальных накоплений, особенно в воспитании детей", "Приоритет духовного, Крепкая семья"),
    
    # Основные ценности: Милосердие + Служение Отечеству
    ("Врач, работающий в зоне военного конфликта, проявляет милосердие к раненым и служит Отечеству", "Милосердие, Служение Отечеству"),
    
    # Основные ценности: Созидательный труд + Единство народов
    ("Труд учителя формирует нравственные идеалы молодёжи и способствует единству народов России", "Созидательный труд, Единство народов России")
]

def main():
    # Загрузка обученной модели
    tokenizer, model, device = load_model(MODEL_SAVE_PATH)
    
    # Тестирование
    for i, (text, expected) in enumerate(test_texts):
        print(f"\nТекст #{i+1}: {text}")
        print(f"Ожидаемые ценности: {expected}")
        
        predictions = predict(text, tokenizer, model, device)
        
        # Выводим результаты по убыванию вероятности
        print("\nРезультаты классификации:")
        for value, prob in predictions:
            if prob > 5.0:  # Показываем только >5%
                print(f"- {value}: {prob:.1f}%")
        
        # Генерация объяснений для первых 3 текстов
        if i < 3:
            print("\nОбъяснение предсказания (топ-5 слов для каждой ценности):")
            try:
                explanations = explain_prediction(text, tokenizer, model, device)
                
                # Выводим только значимые ценности (>5%)
                for value, prob in predictions:
                    if prob > 5.0 and value in explanations:
                        words = ", ".join([f"{word} ({weight:.2f})" for word, weight in explanations[value]])
                        print(f"- {value}: {words}")
                
                print()
            except Exception as e:
                print(f"Ошибка при генерации объяснений: {e}")

if __name__ == "__main__":
    main()